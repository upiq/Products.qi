<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/general/macros/master"
      i18n:domain="Products.qi">
<head>
</head>

<body>
<div metal:fill-slot="main"
    tal:define="email string:email;
                subject string:subject;
                listserve string:list;
                body string:body;
                baseErrors python:view.getError('base')">
    
    <tal:warnings condition="python:len(view.availableMailingLists())==0">
        <div class="warning">
            <h3> Warning: </h3>
            There are no mailing lists for this project or team.
Please add a mailing list to your project or team and send this message again or
contact your project manager or team lead to add users.
        </div>
    </tal:warnings>
    
    <div tal:condition="baseErrors" class="error">
        <h3>The message was not sent.</h3>
    </div>
    
    <tal:generalErrors condition="baseErrors" repeat="err baseErrors">
        <div class="error" tal:content="err">
            General error
        </div>
    </tal:generalErrors>
    
<h3>Send Mail to My Mailing Lists</h3>
<p class="explanation">
Select a mailing list, enter the subject and the message body, then click send. 
The mail will be sent to all members of the selected mailing list.
</p>


<form
    action='.'
    tal:attributes="action view/url"
  	method="post"
  	id="Email">

	<fieldset id="mail">

        <div class="field"
 			tal:define="localname email;
 			            errors python:view.getError(localname);
   			            localvalue python:member.getId()"
 			tal:attributes="class python:errors and 'field error' or 'field'">

            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<input type="hidden"
   				tal:attributes="name localname;
   								id localname;
   								value localvalue"
   	        />
        </div>
        
                
        <div class="field" style="clear:none"
 			tal:define="localname listserve;
 			            errors python:view.getError(localname);
 			            localvalue python:request.get(  
 			                                    localname, 
 			                                    view.defaultlistserv())"
 			tal:attributes="class python:errors and 'field error' or 'field'">

 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for localname">Mailing list to send to</label>
   	        <br />

            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<select
   				tal:attributes="name localname;
   								id localname;
   								"
   	        >
   	            <option value="-1">-------</option>
   	            <tal:choices repeat="choice view/availableMailingLists">
   	                <option 
   	                    tal:attributes="value choice/id;
   	                        selected python:int(choice.id)==int(localvalue)" 
   	                    tal:content="choice">
   	                    </option>
   	            </tal:choices>
   	        </select>
        </div>

        
        
        <div class="field"
 			tal:define="localname subject;
 			            errors python:view.getError(localname);
   			            localvalue python:request.get(localname, '')"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for localname">Subject</label>

            <div><tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors></div>

			<input type="text"
   				tal:attributes="name localname;
   								id localname;
   								value localvalue"
   	        />
        </div>
        <div class="field"
 			tal:define="localname body;
 			            errors python:view.getError(localname);
   			            localvalue python:request.get(localname, '')"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for localname">Message Body</label>

            <div><tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors></div>

			<textarea
				rows="20"
   				tal:attributes="name localname;
   								id localname;"
   	            tal:content="localvalue"
   	        ></textarea>
        </div>
        

		<div class="formControls">

			<input class="context"
   				type="submit"
   				name="send"
   				value="Send"
   				/>
   	    </div>

	</fieldset>

</form>

</div>
</body>
</html>
