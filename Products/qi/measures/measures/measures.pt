<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/general/macros/master"
      i18n:domain="Products.qi">
<head metal:fill-slot="javascript_head_slot">
	<script type="text/javascript">
		function showlist(table)
		{
			thetrs = document.getElementById(table).getElementsByTagName("tr");

			for (var i=0; i<thetrs.length;i++){
				thetrs[i].style.display = '';
				
			}
		}
		function hidelist(table)
		{
			thetrs = document.getElementById(table).getElementsByTagName("tr");

			for (var i=0; i<thetrs.length;i++){
				thetrs[i].style.display = 'none';
			}
		}
	</script>
</head>

<body>
<div metal:fill-slot="main"
    tal:define="measure string:measure;
                start string:start;
                end string:end;
                topic string:topic;
                validation string:validation;
                presentMeasures view/getPresentMeasures;
                presentTopics view/getPresentTopics;
                hasMeasures python:len(presentMeasures)>0;
                hasTopics python:len(presentTopics)>0;
                baseErrors python:view.getError('base')">
    
    <h2>Manage Project Measures</h2>
<form
    action='.'
    tal:attributes="action view/url"
  	method="post"
  	id="activate_deactivate">

        <h3>Subscribed Measures</h3>
        
		<fieldset>
			<legend>
				<a href="javascript:showlist('measureTable')">Show</a>
				<a href="javascript:hidelist('measureTable')">Hide</a>
			</legend>
		
		<p  tal:condition="python:not(hasMeasures)">There are no subscribed measures for this project.</p>
        <table class="listing" id="measureTable" tal:define="cols string:7;" 
            class="datatable" tal:condition="hasMeasures">
            <tal:measurepart condition="hasMeasures" >
                <tr>
                    <!--<th>&nbsp</th>-->
                    <th>Name</th>
                    <th>Short name</th>
                    <th>Active</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Edit</th>
                </tr>
                
                <tal:presentMeasures repeat="projMeasure presentMeasures">
                
                    <tr tal:define="
                                    meas projMeasure/measure;
                                    oddrow repeat/projMeasure/odd;"
                        tal:attributes="class python:oddrow and 'odd' or 'even'">
                        
                        <td tal:content="meas/name">measure name</td>
                        
                        <td tal:content="meas/shortname">short name</td>

                        <!--<td tal:content="python:projMeasure.active and 'Yes' or 'No'">
                            active?
                        </td>-->
                        <td>
                            <input type="hidden" 
                                   name="measureRecs.id:records:int"
                                   tal:attributes="value projMeasure/id"/>
                        
                            <input type="checkbox" 
                                   name="measureRecs.active:records" 
                                   tal:attributes="value projMeasure/active;
                                                   checked python:projMeasure.active and 'checked' or ''"/>
                        </td>

                        <!--<td tal:content="projMeasure/startdate">start</td>-->
                        <td><input type="text" 
                                   name="measureRecs.startdate:records"
                                   tal:attributes="value 
                                   python:view.reformatdate(projMeasure.startdate)"/></td>

                        <!--<td tal:content="projMeasure/enddate">end</td>-->
                        <td><input type="text" 
                                   name="measureRecs.enddate:records"
                                   tal:attributes="value 
                                   python:view.reformatdate(projMeasure.enddate)"/>
                        </td>

                        <td tal:define="format string:%s/Add_Measure.html?measureid=%i;
                                        contexturl view/context/absolute_url;
                                        target python:format%(contexturl,meas.id)">
                            <a tal:attributes="href target">edit</a>
                        </td>
                        
                    </tr>
                
                </tal:presentMeasures>
            </tal:measurepart>
            
        </table>
        <div class="formControls">

            <input class="context"
                type="submit"
                name="apply-changes"
                value="Apply Changes"
                />
		</div>
		</fieldset>
	</form>
	
	<div tal:condition="baseErrors" class="error">
	    <h3>The addition failed see reasons below</h3>
	</div>

	<tal:generalErrors condition="baseErrors" repeat="err baseErrors">
	    <div class="error" tal:content="err">
	        General error
	    </div>
	</tal:generalErrors>

	
<form 
    action='.'
    tal:attributes="action view/url"
  	method="post"
  	id="addMeasure">
  	
	<fieldset id="measure">
        <h3>Add a Measure</h3>
  	    <p>To add a measure to the project, select a measure to add to this project,
	 		enter the information in this section and click 'Add Measure'. </p>

        <div class="field" style="clear:none"
 			tal:define="localname measure;
 			            errors python:view.getError(localname);
 			            localvalue python:request.get(localname, -1)"
 			tal:attributes="class python:errors and 'field error' or 'field'">

 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for localname">Measure:</label>

			<p class="description">
				Choose the measure you wish to add to this project.
				Measures are globally defined and shared among quality improvement projects.
				If the measure you wish to use has not yet been created, a project manager can create 
				a new one under the menu item "Shared Resources-&gt;Create New Measure". Detailed information
				about existing measures may also be viewed there.
			</p>
            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<select 
   				tal:attributes="name localname;
   								id localname;
   								"
   	        >
   	            <option value="-1">-------</option>
   	            <tal:choices repeat="choice view/getAvailableMeasures">
   	                <option 
   	                    tal:attributes="value choice/id;
   	                        selected python:int(choice.id)==int(localvalue);" 
   	                    tal:content="python:'%s: %s'%
   	                    (choice.shortname,choice.name)">
   	                    </option>
   	            </tal:choices>
   	        </select>
        </div>

        <div class="field"
 			tal:define="errors python:view.getError(start);"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for start">Start date:</label><span class="fieldRequired">Required</span>
   	        <p class="description" >
   	        Enter the measure's start date (MM/DD/YYYY).
   	        </p>

            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<input type="text"
   				tal:attributes="name start;
   								id start;
   								value python:request.get(start,'')"
   	        />
        </div>
        
        <div class="field"
 			tal:define="errors python:view.getError(end);"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for measure">End date:</label>
   	        <p class="description">Enter the measure's end date (MM/DD/YYYY).</p>

            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<input type="text"
   				tal:attributes="name end;
   								id end;
   								value python:request.get(end,'')"
   	        />
        </div>
        
        <p>Default validation rules for the measure (as specified in the measure definition) 
        will automatically be applied. If additional validation rules are needed for the measure in this 
        project, specify them in the field below.  Example put "int()" below if you would like to
 		require that all values entered this measure are whole numbers.</p>
        
        <div class="field"
 			tal:define="errors python:view.getError(validation)"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for measure">Additional validation for this project:
   				</label>


            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<input type="text"
   				tal:attributes="name validation;
   								id validation;
   								value python:request.get(validation,'')"
   	        />
        </div>
        
		<div class="formControls">
			<input class="context"
   				type="submit"
   				name="add_measure"
   				value="Add Measure"
   				/>
		</div>

	</fieldset>

</form>

<form
    action='.'
    tal:attributes="action view/url"
  	method="post"
  	id="activate_deactivate">
   
    <h3 >Subscribed Topics</h3>
    
	<fieldset>
		<legend>
			<a href="javascript:showlist('topicTable')">Show</a>
			<a href="javascript:hidelist('topicTable')">Hide</a>
		</legend>
		
	<p tal:condition="python:not(hasTopics)">There are no subscribed topics for this project.</p>
    <table  class="listing" id="topicTable" tal:define="cols string:7"
        class="datatable" tal:condition="python:hasTopics">

        <tal:topicpart condition="hasTopics">
            <tr style='design:none'>
                <th>&nbsp;</th>
                <th>Name</th>
                <th>Active</th>
                <th>Start Date</th>
                <th>End Date</th>
                
            </tr>
            
            <tal:presentTopics repeat="projTopic presentTopics">
            <tr tal:define="tpc projTopic/topic;
                            oddrow repeat/projTopic/odd;"
                tal:attributes="class python:oddrow and 'odd' or 'even'" style='design:none'>
                            
                <td><input type="checkbox" name="topics:int:list"
                    tal:attributes="value projTopic/id"/></td>
                <td tal:content="tpc/name">topic name</td>
                <td tal:content="python:projTopic.active and 'Yes' or 'No'">
                    active
                </td>
                <td tal:content="projTopic/startdate">start</td>
                <td tal:content="projTopic/enddate">end</td>
            </tr>
            </tal:presentTopics>
        </tal:topicpart>
        
    </table>

    <div class="formControls">

        <input class="context"
            type="submit"
            name="apply-changes"
            value="Apply Changes"
            />
	</div>
	</fieldset>
</form>

<div tal:condition="baseErrors" class="error">
    <h3>The addition failed see reasons below</h3>
</div>

<tal:generalErrors condition="baseErrors" repeat="err baseErrors">
    <div class="error" tal:content="err">
        General error
    </div>
</tal:generalErrors>


<form
    action='.'
	tal:define="formname string:measureform"
    tal:attributes="action view/url;
					name formname"
  	method="post"
  	id="addTopic">

	<fieldset id="topic">
        <h3>Add a Topic</h3>
        <p>To add a topic to the project, enter the information in this section and click 'Add Topic'.<br/>
        (All the measures associated with the topic will be added to the project.)</p>

        <div class="field" style="clear:none"
 			tal:define="localname topic;
 			            errors python:view.getError(localname);
 			            localvalue python:request.get(localname, -1)"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for localname">Topic:</label>

            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<select
   				tal:attributes="name localname;
   								id localname;
   								"
   	        >
   	            <option value="-1">-------</option>
   	            <tal:choices repeat="choice view/getAvailableTopics">
   	                <option 
   	                    tal:attributes="value choice/id;
   	                        selected python:int(choice.id)==int(localvalue)" 
   	                    tal:content="choice">
   	                    </option>
   	            </tal:choices>
   	        </select>
        </div>
        <div class="field"
 			tal:define="errors python:view.getError(start)"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for start">Start date:</label>

            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<input type="text"
   				tal:attributes="name start;
   								id start;
   								value python:request.get(start,'')"
   	        />
			<!-- <tal:calendar 
				define="
					id start;
					inputname start;
					inputvalue python:request.get(start,'');"
				>
				<metal:calendar use-macro="here/calendar_macros/macros/calendarDatePickerBox">
					if this works a calendar will be here
				</metal:calendar>
			</tal:calendar>
			-->
        </div>
        
        <div class="field"
 			tal:define="errors python:view.getError(end)"
 			tal:attributes="class python:errors and 'field error' or 'field'">


 			<label i18n:translate="label_uploadtype_name"
   				tal:attributes="for measure">End date:</label>

            <tal:errors repeat="error errors">
                <div tal:content="error">Validation error output</div>
            </tal:errors>

			<input type="text"
   				tal:attributes="name end;
   								id end;
   								value python:request.get(end,'')"
   	        />
        </div>
        
		<div class="formControls">
			<input class="context"
   				type="submit"
   				name="add_topic"
   				value="Add Topic"
   				/>
		</div>

	</fieldset>

</form>

</div>
</body>
</html>
